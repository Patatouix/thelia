class ImagePicker {
    constructor(element) {
        this.element = element;
        this.hasBlankOption = false;
    }

    init() {
        const options = this.element.options;
        this.element.style.display = 'none';

        let ul = document.createElement('ul');
        ul.classList.add('thumbnails', 'image_picker_selector');

        Array.from(options).forEach((option) => {
            if (option.value) {
                if (option.dataset.imgSrc !== undefined) {
                    let li = '<li><div class="thumbnail' + (option.selected ? ' selected' : '') + '" data-value="' + option.value + '">'
                                + '<img class="image_picker_image" src="' + option.dataset.imgSrc + '">'
                            + '</div></li>';
                    ul.innerHTML += li;
                }
            } else {
                this.hasBlankOption = true;
            }
        });
        this.element.insertAdjacentElement('afterend', ul);

        this.addEvents();
    }

    addEvents() {
        const thumbnails = document.querySelectorAll('.thumbnails.image_picker_selector .thumbnail');

        thumbnails.forEach((thumbnail) => {

            thumbnail.addEventListener('click', (event) => {

                if (thumbnail.classList.contains('selected')){
                    if (this.hasBlankOption) {
                        this.element.value = '';
                        thumbnail.classList.remove('selected');
                    }
                } else {
                    this.element.value = thumbnail.dataset.value;
                    const selectedThumbnail = document.querySelector('.thumbnails.image_picker_selector .thumbnail.selected');
                    if (selectedThumbnail) selectedThumbnail.classList.remove('selected');
                    thumbnail.classList.add('selected');
                }
            })
        })
    }
}